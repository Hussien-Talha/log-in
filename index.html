<html>
<head>
  <style>
    body {
      font-family: Arial, sans-serif;
    }

    .container {
      width: 80%;
      margin: auto;
    }

    h1 {
      text-align: center;
    }

    form {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    input, textarea {
      width: 50%;
      padding: 10px;
      margin: 10px;
      border: 1px solid #ccc;
    }

    button {
      width: 20%;
      padding: 10px;
      margin: 10px;
      background-color: #0099ff;
      color: white;
      border: none;
      cursor: pointer;
    }

    .message {
      color: green;
      font-weight: bold;
    }

    .error {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Simple Text Saver</h1>
    <form id="login-form">
      <input type="text" id="username" placeholder="Enter your username" required>
      <input type="password" id="password" placeholder="Enter your password" required>
      <button type="submit" id="login-button">Log In</button>
      <button type="button" id="signup-button">Sign Up</button>
      <p id="login-message" class="message"></p>
      <p id="login-error" class="error"></p>
    </form>
    <form id="text-form" hidden>
      <textarea id="text-area" placeholder="Write your text here"></textarea>
      <button type="submit" id="save-button">Save</button>
      <button type="button" id="logout-button">Log Out</button>
      <p id="text-message" class="message"></p>
      <p id="text-error" class="error"></p>
    </form>
  </div>
  <script>
// Import MongoClient
const { MongoClient } = require("mongodb");

// Replace the uri string with your MongoDB deployment's connection string.
const uri = "mongodb+srv://hussien:Crazy296@log-in.xnq1tc4.mongodb.net/";

// Create a new MongoClient
const client = new MongoClient(uri);

// The database to use
const dbName = "text-saver";

async function main() {
  try {
    // Connect the client to the server
    await client.connect();
    console.log("Connected successfully to server");
    // Get the database
    const db = client.db(dbName);
    // Get the collection
    const collection = db.collection("texts");
    // Get the user input
    let username = usernameInput.value;
    let password = passwordInput.value;
    let text = textArea.value;
    // Check if the user exists
    let user = await collection.findOne({ username: username });
    if (user) {
      // Check if the password matches
      if (user.password === password) {
        // Log in the user and show the text form
        currentUser = username;
        loginForm.hidden = true;
        textForm.hidden = false;
        loginMessage.textContent = "You have logged in as " + username + ".";
        loginError.textContent = "";
        // Load the user's text from the database if any
        textArea.value = user.text || "";
      } else {
        // Show an error message
        loginError.textContent = "Invalid username or password.";
      }
    } else {
      // Create a new user and log in
      await collection.insertOne({ username: username, password: password, text: "" });
      login(username, password);
    }
  } finally {
    // Close the connection
    await client.close();
  }
}

// A function to save the user's text
async function save(text) {
  try {
    // Connect the client to the server
    await client.connect();
    console.log("Connected successfully to server");
    // Get the database
    const db = client.db(dbName);
    // Get the collection
    const collection = db.collection("texts");
    // Check if the user is logged in
    if (currentUser) {
      // Save the text to the database and show a message
      await collection.updateOne({ username: currentUser }, { $set: { text: text } });
      textMessage.textContent = "Your text has been saved.";
    } else {
      // Show an error message
      textError.textContent = "You are not logged in.";
    }
  } finally {
    // Close the connection
    await client.close();
  }
}

// Add event listeners to the buttons
loginButton.addEventListener("click", function(event) {
  event.preventDefault();
  main().catch(console.error);
});

saveButton.addEventListener("click", function(event) {
  event.preventDefault();
  let text = textArea.value;
  save(text).catch(console.error);
});

logoutButton.addEventListener("click", function(event) {
  event.preventDefault();
  logout();
});
  </script>
</body>
</html>
